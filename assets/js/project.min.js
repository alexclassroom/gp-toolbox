jQuery(document).ready(function($){var userLocale=gpToolboxProject.user_locale,supportedTranslationStatuses=gpToolboxProject.supported_statuses,tableTranslationSets=$("table.gp-table.translation-sets"),glotpressAdmin=gpToolboxProject.admin,gpUrlProject=gpToolboxProject.gp_url_project,project=gpToolboxProject.args.project,dataPrefix="gptoolboxdata-",highlightCounts=!1;function updateHighlight(element){!1!==highlightCounts&&(element?"0"===$(element).find("a").text()?$(element).removeClass("highlight"):$(element).addClass("highlight"):$(tableTranslationSets).find("td.stats").each(function(){"0"===$(this).find("a").text()?$(this).removeClass("highlight"):$(this).addClass("highlight")}))}function deleteTranslationsStart(locale,slug,status){var td=$(tableTranslationSets).find("tbody tr["+dataPrefix+'locale="'+locale+'"]['+dataPrefix+'slug="'+slug+'"] td.stats.'+status),notice=$(td).find("div.progress-notice"),stats=$(td).find("a.count"),td=$(td).find("button.delete");$(stats).hide(),$(td).hide().attr("disabled",!0),$(notice).text(wp.i18n.__("Deleting...","gp-toolbox")).fadeIn(),$.ajax({url:wpApiSettings.root+"gp-toolbox/v1/translations/"+project.path+"/"+locale+"/"+slug+"/"+status+"/-delete-start",type:"POST",success:function(response){var deleting=response.deleting,response=response.percent;!0===deleting&&0===response&&(!function(locale,slug,status){var td=$(tableTranslationSets).find("tbody tr["+dataPrefix+'locale="'+locale+'"]['+dataPrefix+'slug="'+slug+'"] td.stats.'+status),notice=$(td).find("div.progress-notice"),stats=$(td).find("a.count"),button=$(td).find("button.delete");$(stats).hide(),$(button).hide().attr("disabled",!0),$(notice).text(wp.i18n.__("Deleting...","gp-toolbox")).fadeIn(),$.ajax({url:wpApiSettings.root+"gp-toolbox/v1/translations/"+project.path+"/"+locale+"/"+slug+"/"+status+"/-delete",type:"POST",success:function(response){var count=null;"old"===status?count=response.translations.old:"rejected"===status&&(count=response.translations.rejected),$(stats).text(new Intl.NumberFormat(userLocale.slug).format(count)),stats.text("0"),$(notice).hide().text(""),$(stats).fadeIn(),updateHighlight(td),updateStats(locale,slug,status,100)},error:function(response){}})}(locale,slug,status),setTimeout(deleteTranslationsProgress,3e3,locale,slug,status))},error:function(response){}})}function deleteTranslationsProgress(locale,slug,status){$.ajax({url:wpApiSettings.root+"gp-toolbox/v1/translations/"+project.path+"/"+locale+"/"+slug+"/"+status+"/-delete-progress",type:"GET",beforeSend:function(){},success:function(response){var deleting=response.deleting,response=parseInt(response.percent);deleting&&response<100&&(setTimeout(deleteTranslationsProgress,3e3,locale,slug,status),updateStats(locale,slug,status,response))},error:function(response){}})}function updateStats(locale,slug,status,percent){var locale=$(tableTranslationSets).find("tbody tr["+dataPrefix+'locale="'+locale+'"]['+dataPrefix+'slug="'+slug+'"] td.stats.'+status),slug=$(locale).find("div.progress-notice"),stats=$(locale).find("a.count");percent<100?$(locale).css("background","linear-gradient(90deg, var(--gp-color-secondary-100) "+percent+"%, var(--gp-color-status-"+status+"-subtle) "+percent+"%)"):(updateHighlight(locale),$(locale).css("background",""),$(slug).hide(),$(stats).fadeIn())}"1"===gpToolboxProject.highlight_counts&&(highlightCounts=!0),tableTranslationSets.length&&(supportedTranslationStatuses.hasOwnProperty("old")&&$(tableTranslationSets).children("thead").children("tr").find("th:last").after('<th class="gptoolbox-column-old">'+wp.i18n.__("Old","gp-toolbox")+"</td>"),supportedTranslationStatuses.hasOwnProperty("rejected")&&$(tableTranslationSets).children("thead").children("tr").find("th:last").after('<th class="gptoolbox-column-rejected">'+wp.i18n.__("Rejected","gp-toolbox")+"</td>"),supportedTranslationStatuses.hasOwnProperty("changesrequested")&&$(tableTranslationSets).children("thead").children("tr").find("th:last").after('<th class="gptoolbox-column-changesrequested">'+wp.i18n.__("Changes requested","gp-toolbox")+"</td>"),$(tableTranslationSets).children("tbody").children("tr").each(function(){supportedTranslationStatuses.hasOwnProperty("old")&&$(this).find("td:last").after('<td class="stats old"></td>'),supportedTranslationStatuses.hasOwnProperty("rejected")&&$(this).find("td:last").after('<td class="stats rejected"></td>'),supportedTranslationStatuses.hasOwnProperty("changesrequested")&&$(this).find("td:last").after('<td class="stats changesrequested"></td>'),$(this).children("td:first-child").find("a").each(function(){var regexPattern=new RegExp("^"+gpUrlProject+".*"+project.path+"/(.*)/(.*)/$"),regexPattern=$(this).attr("href").match(regexPattern),locale=regexPattern[1],regexPattern=regexPattern[2];$(this).closest("tr").attr(dataPrefix+"locale",locale),$(this).closest("tr").attr(dataPrefix+"slug",regexPattern),$(this).closest("tr").attr(dataPrefix+"projectpath",project.path)})}),$(tableTranslationSets).children("tbody").children("tr").each(function(){var locale=$(this).attr("gptoolboxdata-locale"),translationSet=gpToolboxProject.args.translation_sets[locale],locale=$(this).children("td:first-child").find("a").attr("href"),old=$(this).children("td.stats.old"),rejected=$(this).children("td.stats.rejected");supportedTranslationStatuses.hasOwnProperty("old")&&$(this).find("td.stats.old").attr("data-text",translationSet.old_count).html('<div class="progress-notice" style="display: none;"></div><a class="count" href="'+locale+'?filters[status]=old">'+new Intl.NumberFormat(userLocale.slug).format(translationSet.old_count)+"</a>"),supportedTranslationStatuses.hasOwnProperty("rejected")&&$(this).find("td.stats.rejected").attr("data-text",translationSet.rejected_count).html('<div class="progress-notice" style="display: none;"></div><a class="count" href="'+locale+'?filters[status]=rejected">'+new Intl.NumberFormat(userLocale.slug).format(translationSet.rejected_count)+"</a>"),supportedTranslationStatuses.hasOwnProperty("changesrequested")&&$(this).find("td.stats.changesrequested").attr("data-text",translationSet.changesrequested_count).html('<a class="count" href="'+locale+'?filters[status]=changesrequested">'+new Intl.NumberFormat(userLocale.slug).format(translationSet.changesrequested_count)+"</a>"),glotpressAdmin&&($(old).find("a.count").after('<button class="delete hidden" disabled><span class="dashicons dashicons-trash"></span></button>'),$(rejected).find("a.count").after('<button class="delete hidden" disabled><span class="dashicons dashicons-trash"></span></button>'),"0"!==$(old).find("a.count").text().trim()&&$(old).find("button.delete").attr("disabled",!1).removeClass("hidden"),"0"!==$(rejected).find("a.count").text().trim()&&$(rejected).find("button.delete").attr("disabled",!1).removeClass("hidden"),$(old).find("button.delete").on("click",function(){deleteTranslationsStart(translationSet.locale,translationSet.slug,"old")}),$(rejected).find("button.delete").on("click",function(){deleteTranslationsStart(translationSet.locale,translationSet.slug,"rejected")}))}),updateHighlight())});